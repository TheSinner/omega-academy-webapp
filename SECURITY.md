# 🔒 보안 가이드

## 적용된 보안 조치

### 1. 인증 및 권한 관리 ✅
- **JWT 토큰 기반 인증**: 모든 API 요청에 토큰 필요
- **bcrypt 비밀번호 해싱**: 평문 저장 없음
- **역할 기반 접근 제어**: 관리자, 조교, 학생 권한 구분

### 2. API 보안 강화 ✅
- **회원가입 API**: 관리자 인증 필수 (외부 접근 차단)
- **비밀번호 재설정**: 관리자 인증 필수
- **이미지 업로드 검증**: 크기 제한 (공지 10MB, 질문/답글 5MB)

### 3. Rate Limiting (요청 제한) ✅
- **로그인**: 5분에 5회 시도까지
- **일반 API**: 1분에 30회까지
- **이미지 업로드**: 10분에 20회까지 (학생 질문 고려)

### 4. 공격 방어
- **Brute Force 방어**: 로그인 시도 제한
- **DDoS 방어**: IP별 요청 수 제한
- **이미지 폭탄 방어**: 파일 크기 제한

---

## Cloudflare 무료 플랜 제한

| 서비스 | 무료 한도 | 초과 시 비용 |
|--------|-----------|--------------|
| Workers 요청 | 100,000건/일 | $0.50/백만 요청 |
| D1 읽기 | 500만건/일 | $0.001/천 읽기 |
| D1 쓰기 | 10만건/일 | $1.00/백만 쓰기 |
| R2 저장 | 10GB | $0.015/GB/월 |
| R2 Class A 요청 | 100만건/월 | $4.50/백만 |
| R2 Class B 요청 | 1,000만건/월 | $0.36/백만 |

---

## 비용 예산 알림 설정

### Cloudflare 대시보드에서 설정하기:

1. **Cloudflare 대시보드 접속**
   - https://dash.cloudflare.com

2. **계정 설정으로 이동**
   - 우측 상단 프로필 → Account Home

3. **Notifications 설정**
   - 좌측 메뉴에서 "Notifications" 클릭

4. **예산 알림 추가**
   - "Add" → "Usage-based Billing"
   - 알림 받을 이메일 입력
   - 예산 임계값 설정 (예: $5, $10, $20)

5. **일일 요청 알림 추가**
   - Workers 일일 요청이 80,000건 초과 시 알림

---

## 예상 비용 (정상 사용 시)

### 학원 규모별 예상:
- **소규모 (학생 30명)**: 무료 플랜으로 충분
- **중규모 (학생 100명)**: 무료 플랜으로 충분
- **대규모 (학생 300명)**: 월 $1-2 예상

### 비용 발생 시나리오:
- 하루 100,000 Workers 요청 초과 시: 약 $0.50/일
- R2 저장 10GB 초과 시: $0.015/GB/월
- 대량 이미지 업로드 시: $1-5/월

---

## 비용 폭탄 방지 조치

### 1. Rate Limiting으로 차단됨 ✅
- 로그인 공격: 5분 5회로 제한
- API 공격: 1분 30회로 제한
- 이미지 업로드 공격: 10분 20회로 제한

### 2. 회원가입 관리자 전용 ✅
- 외부에서 계정 생성 불가능
- 무제한 계정 생성 방지

### 3. 이미지 크기 제한 ✅
- 공지사항: 10MB까지
- 질문/답글: 5MB까지
- R2 저장 공간 폭발 방지

### 4. Cloudflare 자동 보호 ✅
- DDoS 공격 자동 차단
- 악의적 트래픽 필터링
- CDN 캐싱으로 요청 감소

---

## 권장 설정

### 1. 이메일 알림 설정 (필수)
```
예산 알림: $5, $10, $20
일일 요청 알림: 80,000건
```

### 2. 정기 모니터링
- 주 1회: Cloudflare Analytics 확인
- 월 1회: 사용량 및 비용 확인

### 3. 학생 교육
- 이미지 크기 최적화 권장 (1-2MB)
- 불필요한 페이지 새로고침 자제

---

## 긴급 상황 대응

### 비정상적인 요청 증가 시:
1. Cloudflare Analytics에서 원인 파악
2. 특정 IP 차단 필요 시 Firewall Rules 추가
3. 임시로 사이트 비활성화 가능

### 관리자 계정 탈취 의심 시:
1. 즉시 관리자 비밀번호 변경
2. JWT 비밀키 재생성 (모든 사용자 로그아웃)
3. 최근 활동 로그 확인

---

## 추가 보안 강화 (선택)

### 장기적으로 고려할 사항:
1. **IP 화이트리스트**: 학원 내부 IP만 관리자 접근 허용
2. **2단계 인증 (2FA)**: 관리자 계정에 추가 보안
3. **API 키 교체**: 정기적인 JWT 비밀키 갱신
4. **로그 분석**: 의심스러운 활동 패턴 탐지

---

## 문의 및 지원

보안 관련 문제 발견 시:
- Cloudflare 지원: https://support.cloudflare.com
- GitHub Issues로 제보

**마지막 업데이트**: 2025-10-26
